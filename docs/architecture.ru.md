# Архитектура

CoverMBA следует модульной архитектуре с четким разделением ответственности. Основные компоненты:

## Основные компоненты

### ApiCoverage
Основной фасадный класс, который управляет процессом отслеживания покрытия. Он:
- Инициализирует и управляет всеми остальными компонентами
- Предоставляет публичный API для пользователей
- Управляет конфигурацией и жизненным циклом

### SwaggerLoader
Отвечает за загрузку и парсинг спецификаций Swagger/OpenAPI:
- Загружает спецификации из файла или URL
- Проверяет формат спецификации
- Извлекает определения эндпоинтов и схемы
- Сопоставляет пути и методы с операциями

### RequestCollector
Управляет сбором и хранением API-запросов:
- Собирает данные запросов во время выполнения тестов
- Хранит запросы в памяти и/или файловой системе
- Предоставляет методы для запроса собранных запросов
- Обрабатывает дедупликацию и агрегацию запросов

### CoverageCalculator
Рассчитывает метрики покрытия на основе собранных запросов:
- Сопоставляет запросы с API-эндпоинтами
- Рассчитывает проценты покрытия
- Определяет покрытые и непокрытые эндпоинты
- Поддерживает расчет частичного покрытия

### ReportGenerator
Генерирует различные форматы отчетов:
- HTML-отчеты с визуальными метриками
- JSON-отчеты с детальными данными
- Пользовательские форматы отчетов
- Управление ресурсами для отчетов

## Компоненты интеграции

### Интеграция с Playwright
Обеспечивает бесшовную интеграцию с Playwright:
- Перехватывает запросы Playwright
- Автоматически собирает данные запросов
- Поддерживает различные подходы к тестированию:
  - Прямые вызовы API
  - Page object model
  - Сервисный слой
  - Классовый подход

### Request Interceptor
Обрабатывает перехват и модификацию запросов:
- Перехватывает HTTP-запросы
- Собирает данные запросов и ответов
- Поддерживает модификацию запросов
- Обрабатывает различные типы запросов

## Вспомогательные компоненты

### Logger
Предоставляет функциональность логирования:
- Настраиваемые уровни логирования
- Вывод в файл и консоль
- Структурированное логирование
- Поддержка режима отладки

### Configuration
Управляет настройками конфигурации:
- Загружает и проверяет конфигурацию
- Предоставляет значения по умолчанию
- Поддерживает переменные окружения
- Обрабатывает переопределения конфигурации

## Поток данных

1. **Инициализация**:
   - ApiCoverage инициализируется с конфигурацией
   - SwaggerLoader загружает и парсит спецификацию
   - RequestCollector настраивается для сбора запросов

2. **Сбор запросов**:
   - Запросы перехватываются во время выполнения тестов
   - Данные запросов собираются и сохраняются
   - Запросы сопоставляются с API-эндпоинтами

3. **Расчет покрытия**:
   - CoverageCalculator обрабатывает собранные запросы
   - Рассчитываются метрики покрытия
   - Данные покрытия подготавливаются для отчетов

4. **Генерация отчетов**:
   - ReportGenerator создает отчеты
   - Отчеты сохраняются в выходную директорию
   - Ресурсы копируются в выходную директорию

## Структура директорий

```
src/
  coverage/
    ApiCoverage.js        # Основной фасад
    SwaggerLoader.js      # Обработка Swagger/OpenAPI
    RequestCollector.js   # Сбор запросов
    CoverageCalculator.js # Расчет покрытия
    ReportGenerator.js    # Генерация отчетов
  integration/
    playwright/          # Интеграция с Playwright
    request/            # Перехват запросов
  support/
    logger.js           # Логирование
    config.js           # Конфигурация
tests/
  integration/          # Интеграционные тесты
  unit/                # Модульные тесты
docs/
  architecture.md      # Документация по архитектуре
  configuration.md     # Документация по конфигурации
  integration.md       # Документация по интеграции
  methods.md           # Документация по методам API
  reports.md           # Документация по отчетам
```

## Принципы проектирования

1. **Модульность**: Каждый компонент имеет единственную ответственность
2. **Расширяемость**: Легко добавлять новые интеграции и форматы отчетов
3. **Настраиваемость**: Гибкие опции конфигурации
4. **Тестируемость**: Компоненты спроектированы для легкого тестирования
5. **Производительность**: Эффективный сбор и обработка запросов
6. **Поддерживаемость**: Четкая структура кода и документация 